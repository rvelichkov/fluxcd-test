# This is a human-readable name for your action, shown in the "Actions" tab
name: Create Pull Request

# This section defines the trigger for the action
on:
  # Run this workflow on every 'push' event
  push:
    # But, DO NOT run this workflow for pushes to the 'main' or 'master' branches
    branches-ignore:
      - 'main'
      - 'master'

# This section defines the jobs that will run
jobs:
  # We have one job, which we'll call 'create-pull-request'
  create-pull-request:
    # Run this job on the latest version of Ubuntu
    runs-on: ubuntu-latest

    # Set the permissions this job needs.
    # It needs to read 'contents' (to get your branch info)
    # and write 'pull-requests' (to create the PR).
    permissions:
      contents: read
      pull-requests: write

    # 'steps' are the individual commands the job will run
    steps:
      # *** ADDED THIS STEP ***
      # Step 1: Check out the repository's code onto the runner
      # This is necessary for the 'gh' command to find the .git directory
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Create the Pull Request using the GitHub CLI (gh)
      - name: Create Pull Request
        # This 'env' block makes the GITHUB_TOKEN available to the 'gh' command
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # The 'gh pr create' command does all the work.
          # We use '|| true' at the end to prevent the workflow from
          # failing if the pull request already exists.
          # We use 'github.ref_name' to get the branch name directly.
          gh pr create \
            --base master \
            --head ${{ github.ref_name }} \
            --title "PR for ${{ github.ref_name }}" \
            --body "Auto-generated PR for branch: ${{ github.ref_name }}" \
            || true
